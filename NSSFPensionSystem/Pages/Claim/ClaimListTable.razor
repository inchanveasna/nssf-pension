
<div class="table-responsive mb-4">
    @*<button type="button" class="btn btn-primary bs-popover rounded" data-container="body" data-trigger="hover" data-content="On Hover" data-original-title="" title="">
        On Hover
    </button>*@
    <table class="table table-hover" id="tableClaimList">
        <thead>
            <tr role="row">
                @foreach (string header in TableHeader)
                {
                    <th class="sorting text-center" tabindex="0" aria-controls="multi-column-ordering">@header</th>
                }
            </tr>
        </thead>
        <tbody>
            @if (ClaimList.Where(w => w.StatusId == StatusId || StatusId == 0).Count() == 0)
            {
                <tr>
                    <td colspan=@TableHeader.Count class="text-center">មិនមានទិន្នន័យត្រូវបង្ហាញ</td>
                </tr>
            }
            @for (int i = 0; i < ClaimList.Where(w => w.StatusId == StatusId || StatusId == 0).Count(); i++)
            {
                ClaimModel c = ClaimList.Where(w => w.StatusId == StatusId || StatusId == 0).ToList()[i];
                <tr>
                    <td class="text-center" style="max-width: 50px">@(i + 1)</td>
                    <td>
                        <div style="display: flex; flex-direction: column; justify-content: center; align-items:center;">
                            <p class="cell-text">@c.ClaCode</p>
                            <p class="cell-subtext">
                                @(c.ClaDate.HasValue ? c.ClaDate.Value.ToString("dd-MM-yyyy") : "")
                            </p>
                        </div>

                    </td>
                    <td class="text-center">@(c.Pensioner.BenNote + "-")<b>@(c.Pensioner.BenId)</b>@("-" + c.Pensioner.BenChar)</td>
                    <td>
                        <div style="display: flex; flex-direction: column; justify-content: center; align-items:center;">
                            <p class="cell-text">@c.Pensioner.FullnameKh</p>
                            <p class="cell-subtext">@c.Pensioner.FullnameEn</p>
                        </div>

                    </td>
                    <td class="text-center" style="max-width: 50px">@(c.Pensioner.BenSexId== "1" ? "ប្រុស" : "ស្រី")</td>
                    <td class="text-center">@(c.Pensioner.BenDob.HasValue ? c.Pensioner.BenDob.Value.ToString("dd-MM-yyyy") : "")</td>

                    <td class="text-center">@(PensionTypes.Where(w=> w.TypeId == c.PsTypeId).Select(s=> s.TypeNameKh).FirstOrDefault())</td>
                    <td class="text-center">
                        <p style="padding: 4px; color: @GetColorForClaimStatus(c.StatusId); border: dashed 1px @GetColorForClaimStatus(c.StatusId);">
                            @(ClaimStatuses.Where(w=> w.StaId == c.StatusId).Select(s=> s.StaName).FirstOrDefault())
                        </p>
                    </td>
                    <td class="text-center">
                        <div class="btn-group" role="group" aria-label="Basic example">
                            <button class="btn btn-dark btn-sm bs-tooltip" title="កែប្រែ" @onclick="()=> OnEditClick(ClaimList.IndexOf(c))">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                            </button>

                            @if (c.StatusId == 1)
                            {
                                <button class="btn btn-dark btn-sm bs-tooltip" @onclick="()=>OnApprovalClick(ClaimList.IndexOf(c), 2)" title="@(ClaimStatuses.Where(w=> w.StaId == 2).FirstOrDefault().StaDescription)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg>
                                </button>
                            }
                            else if (c.StatusId == 2)
                            {
                                <button class="btn btn-danger btn-sm bs-tooltip" @onclick="()=>OnApprovalClick(ClaimList.IndexOf(c), 4)" title="@(ClaimStatuses.Where(w=> w.StaId == 4).FirstOrDefault().StaDescription)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                </button>
                                <button class="btn btn-dark btn-sm bs-tooltip" @onclick="()=>OnApprovalClick(ClaimList.IndexOf(c), 3)" title="@(ClaimStatuses.Where(w=> w.StaId == 3).FirstOrDefault().StaDescription)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg>
                                </button>
                            }
                            else if (c.StatusId == 3)
                            {
                                <button class="btn btn-danger btn-sm bs-tooltip" @onclick="()=>OnApprovalClick(ClaimList.IndexOf(c), 6)" title="@(ClaimStatuses.Where(w=> w.StaId == 6).FirstOrDefault().StaDescription)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-circle"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                                </button>
                                <button class="btn btn-dark btn-sm bs-tooltip" @onclick="()=>OnApprovalClick(ClaimList.IndexOf(c), 5)" title="@(ClaimStatuses.Where(w=> w.StaId == 5).FirstOrDefault().StaDescription)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                                </button>
                            }
                            else if (c.StatusId == 5)
                            {
                                <button class="btn btn-danger btn-sm bs-tooltip" @onclick="()=>OnApprovalClick(ClaimList.IndexOf(c), 8)" title="@(ClaimStatuses.Where(w=> w.StaId == 8).FirstOrDefault().StaDescription)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x-square"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="9" x2="15" y2="15"></line><line x1="15" y1="9" x2="9" y2="15"></line></svg>
                                </button>
                                <button class="btn btn-dark btn-sm bs-tooltip" @onclick="()=>OnApprovalClick(ClaimList.IndexOf(c), 7)" title="@(ClaimStatuses.Where(w=> w.StaId == 7).FirstOrDefault().StaDescription)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check-square"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
                                </button>
                            }
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>



@code {

    [Parameter]
    public List<PensionTypeModel> PensionTypes { get; set; }

    [Parameter]
    public List<ClaimStatusModel> ClaimStatuses { get; set; }


    [Parameter]
    public List<String> TableHeader { get; set; }

    [Parameter]
    public List<ClaimModel> ClaimList { get; set; }

    [Parameter]
    public int StatusId { get; set; }


    [Parameter]
    public EventCallback<int> OnEdit { get; set; }


    [Parameter]
    public EventCallback<(int, int)> OnApproval { get; set; }




    public void OnEditClick(int index)
    {
        this.OnEdit.InvokeAsync(index);
    }


    public async Task OnApprovalClick(int index, int statusID)
    {
        await this.OnApproval.InvokeAsync((index, statusID));
    }

 
    public string GetColorForClaimStatus(int id)
    {
        string result = "var(--info)";

        switch (id)
        {
            case 1: result = "var(--info)"; break;
            case 2: result = "var(--warning)"; break;
            case 3:
            case 5:
            case 7:
            case 9:
                result = "var(--success)"; break;
            case 4:
            case 6:
            case 8:
            case 10:
                result = "var(--danger)"; break;
        }

        return result;
    }
}
